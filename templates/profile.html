<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.4.1/dist/css/bootstrap.min.css"
    integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <title>Document</title>

    <style>
body{
font-family: Montserrat, sans-serif;
background-image: url("https://i.pinimg.com/originals/3a/81/05/3a8105197bf6472fa8e825c06a3e5041.gif");

}
.container{
user-select: none;
margin: 100px auto;
background: #ffffff;
color: #01030c;
border-radius: 5px;
width: 350px;
text-align: center;
box-shadow: 0 10px 20px -10px rgba(0,0,0,.75);
}

.profile{
height: 120px;
width: 120px;
border-radius: 50%;
margin: 93px 0 0 -175px;



animation: moveImage 2s ease forwards;

}
@keyframes moveImage {
      from {
        transform: translateX(100%) translateY(-100%);
      }
      to {
        transform: translateX(0) translateY(0);
      }
    }


.profile-name{
font-size: 25px;
font-weight: bold;

animation: moveImageS 2s ease forwards;
}
@keyframes moveImageS {
      from {
        transform: translateY(30px);
      }
      to {
        transform: translateY(0);
      }
    }

.about{
margin-top: 35px;
line-height: 0px;
animation: moveImg 2s ease forwards;
}
@keyframes moveImg {
      from {
        transform: translateX(-80px);
      }
      to {
        transform: translatex(0);
      }
    }


button{
margin: 10px 0 40px 0;
}
.msg-btn, .follow-btn{
background: #03bfbc;
border: 1px solid #03bfbc;
padding: 10px 25px;
color: #231e39;
border-radius: 3px;
font-family: Montserrat, sans-serif;
cursor: pointer;
}
.follow-btn{
margin-left: 10px;
background: transparent;
color: #02899c;
}
.follow-btn:hover{
color: #231e39;
background: #03bfbc;
transition: .5s;
}
.container i{
padding-left: 20px;
font-size: 20px;
margin-bottom: 20px;
cursor: pointer;
transition: .5s;
}
.container i:hover{
color: #03bfbc;
}

    </style>


</head>
<body>

    {% block content %}

<br>
<br>
<br>

<div class="container">
  
  <div class="cover-photo">
    {% for dp in object_list %}
    <img  src="{{ dp.image.url }}">
    {% endfor %}
    <img src="https://cdn-icons-png.flaticon.com/512/8214/8214212.png" class="profile">
    <i  id="open-form-button" title="Edit" class="bi bi-pencil-square"></i>
  </div>
  <div class="profile-name"><i class="bi bi-person-circle"></i> {{request.user}}</div>
  <p class="about"> Full Name: {{user.first_name}} {{user.last_name}}</p>
  <p class="about"> Email: {{user.email}}</p>
  <button class="msg-btn">Message</button>
  <button class="follow-btn">Following</button>
  <div>
    <i class="fab fa-facebook-f"></i>
    <i class="fab fa-instagram"></i>
    <i class="fab fa-youtube"></i>
    <i class="fab fa-twitter"></i>
  </div>
</div>


<!-- profile.html -->


<!-- Modal for the form -->
<div id="form-modal" class="modal">
    <div class="modal-content">
      <span class="close">&times;</span>
      <form id="profile-form" enctype="multipart/form-data">
        {% csrf_token %}
        <label for="image">Select Profile Picture:</label>
        <input type="file" id="image" name="image" accept="image/*">
        <br>
        <img id="preview-image" src="#" alt="Preview" style="max-width: 100%; max-height: 200px; margin-top: 10px; display: none;">
        <br>
        <input type="submit" class="btn btn-outline-primary" value="Save">
      </form>
    </div>
  </div>

<script>

// JavaScript code to handle modal and form submission
const modal = document.getElementById('form-modal');
const openFormButton = document.getElementById('open-form-button');
const closeFormButton = document.querySelector('.close');
const profileForm = document.getElementById('profile-form');
const imageInput = document.getElementById('image');
const previewImage = document.getElementById('preview-image');

openFormButton.addEventListener('click', function() {
  modal.style.display = 'block';  // Display the modal when the button is clicked
});

closeFormButton.addEventListener('click', function() {
  modal.style.display = 'none';  // Close the modal when the close button is clicked
});

imageInput.addEventListener('change', function(event) {
  const file = event.target.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = function(e) {
      previewImage.src = e.target.result;
      previewImage.style.display = 'block';  // Display the preview image
    };
    reader.readAsDataURL(file);
  }
});

profileForm.addEventListener('submit', function(event) {
  event.preventDefault();
  const formData = new FormData(profileForm);

  // Send an AJAX request to handle form submission
  fetch('', {
    method: 'POST',
    body: formData,
    headers: {
      'X-CSRFToken': csrftoken,  // Include CSRF token for security
    },
  })
  .then(response => response.json())
  .then(data => {
    if (data.success) {
      alert(data.message);  // Display success message
      modal.style.display = 'none';  // Close the modal after successful submission
      if (previewImage.src !== '') {
        profileImage.src = previewImage.src;  // Update the profile image with the newly selected image
      }
    } else {
      alert('Profile update failed: ' + data.message);  // Handle error message
    }
  })
  .catch(error => {
    console.error('Error:', error);
  });
});
</script>


{% endblock %}
    
</body>
</html>